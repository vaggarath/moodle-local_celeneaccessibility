{"version":3,"file":"tts.min.js","sources":["../src/tts.js"],"sourcesContent":["export const init = (language) => {\n    document.body.addEventListener('contextmenu', (e) => {\n\n        const bodyEl = document.body;\n\n        if (document.getElementById('context-menu')) {\n            if (!e.target.classList.contains(\"item\")) {\n                // Vérifier qu'on ne click pas sur une option du menu.\n                document.getElementById('context-menu').remove();\n            }\n        }\n\n        if (bodyEl.classList.contains('tts') && isClassForbiddenTts(e)) {\n            // Cf celeneaccessibility branch ne sactive que si on a activé l'option dans l'accessibilité.\n            e.preventDefault();\n            if (e.target.innerText) {\n                checkMenu(e);\n            } else if (!e.target.innerText || e.target.innerText === \"\") {\n                if (document.getElementById('context-menu')) {\n                    document.getElementById('context-menu').remove();\n                }\n            }\n        }\n\n        // Créer le context menu.\n        /**\n         *\n         * @param {*} event\n         */\n        function createMenu(event) {\n            const synth = window.speechSynthesis;\n            const { clientX: mouseX, clientY: mouseY } = event;\n\n            const utterThis = new SpeechSynthesisUtterance(event.target.innerText);\n            const targetInnerHtml = event.target.innerHTML;\n\n            const contextMenu = document.createElement('div');\n            contextMenu.id = \"context-menu\";\n            const contextMenuItemFirst = document.createElement('div');\n            contextMenuItemFirst.id = \"item1\";\n            contextMenuItemFirst.innerText = \"Lire pour moi (audio)\";\n            contextMenuItemFirst.classList.add('item');\n            contextMenuItemFirst.onclick = () => {\n                e.preventDefault();\n                createOptionsBar(event);\n                // Default 'fr-FR';\n                utterThis.lang = language && language === \"french\"\n                    ? \"fr-FR\"\n                    : language && language === \"english\"\n                        ? \"en-US\"\n                        : \"fr-FR\";\n                utterThis.rate = 1;\n                utterThis.pitch = 1;\n                synth.speak(utterThis);\n\n                // Const words = event.target.innerText.split(\" \");\n                utterThis.addEventListener('boundary', (e) => {\n                    if (e.name === 'sentence') {\n                        // We only care about word boundaries.\n                        return;\n                    }\n\n                    const wordStart = e.charIndex;\n                    let wordLength = e.charLength;\n                    if (wordLength === undefined) {\n                        // Safari.\n                        const match = event.target.innerText.substring(wordStart).match(/^[a-z\\d']*/i);\n                        wordLength = match[0].length;\n                    }\n                    // Wrap word in <mark> tag.\n                    const wordEnd = wordStart + wordLength;\n                    const word = event.target.innerText.substring(wordStart, wordEnd);\n                    let markedText = event.target.innerText.substring(0, wordStart);\n                    markedText += '<mark>' + word + '</mark>';\n                    markedText += event.target.innerText.substring(wordEnd);\n\n                    event.target.innerHTML = markedText;\n                });\n\n\n                event.target.classList.add(\"highlight\");\n                contextMenu.remove();\n\n                utterThis.addEventListener('end', () => { //les events se mettent sur l'utterance\n                    document.querySelectorAll(\"mark\").forEach(div => {\n                        const span = document.createElement(\"span\");\n                        span.innerText = div.innerText;\n                        div.replaceWith(span);\n                    });\n                    event.target.classList.remove(\"highlight\");\n                    event.target.innerHTML = targetInnerHtml;\n                    // Pause.remove();\n                    removeOptionsBar();\n                });\n            };\n            const contextMenuItemSecond = document.createElement('div');\n            contextMenuItemSecond.id = \"item2\";\n            contextMenuItemSecond.innerText = \"copier\";\n            contextMenuItemSecond.classList.add('item');\n            contextMenuItemSecond.onclick = (e) => {\n                e.preventDefault();\n                navigator.clipboard.writeText(event.target.innerText).then(() => {\n                    new Toast(\"Texte copié : \" + \"\\n\" + event.target.innerText, \"#00b894\", 2500);\n                    contextMenu.remove();\n                });\n            };\n\n            const contextMenuItemFifth = document.createElement('div');\n            contextMenuItemFifth.classList.add('item');\n            contextMenuItemFifth.innerText = \"Inverser les couleurs (alpha)\";\n            contextMenuItemFifth.onclick = () => {\n                event.preventDefault();\n                const elementToChange = event.target;\n                elementToChange.style.filter = elementToChange.style.filter === \"invert(1)\" ? \"invert(0)\" : \"invert(1)\";\n                contextMenu.remove();\n            };\n\n            const contextMenuItemSixth = document.createElement('div');\n            contextMenuItemSixth.classList.add('item');\n            contextMenuItemSixth.innerText = \"Recharger la page\";\n            contextMenuItemSixth.onclick = () => {\n                event.preventDefault();\n                document.location.reload();\n            };\n\n            let contextMenuItemThird = null;\n            if (typeof window.getSelection !== \"undefined\" && window.getSelection !== \"\") {\n                const text = getSelectedText();\n                if (text && text !== \"\") {\n                    contextMenuItemThird = document.createElement('div');\n                    contextMenuItemThird.innerText = \"copier la selection\";\n                    contextMenuItemThird.classList.add('item');\n                    contextMenuItemThird.onclick = (e) => {\n                        e.preventDefault();\n                        new Toast(\"Sélection copiée : \" + \"\\n\" + text, \"#00b894\", 2500);\n                        navigator.clipboard.writeText(text).then(() => {\n                            contextMenu.remove();\n                        });\n                    };\n                }\n            }\n\n            const contextMenuItemFourth = document.createElement('div');\n            contextMenuItemFourth.innerText = \"Tout sélectionner\";\n            contextMenuItemFourth.classList.add('item');\n            contextMenuItemFourth.onclick = (e) => {\n                e.preventDefault();\n                const doc = document.body;\n                let range, selection;\n                selection = window.getSelection();\n                range = document.createRange();\n                range.selectNodeContents(doc);\n                selection.removeAllRanges();\n                selection.addRange(range);\n                contextMenu.remove();\n            };\n\n            // Titre to append.\n            const contextTitle = document.createElement('p');\n            contextTitle.innerText = \"Options\";\n            contextTitle.classList.add('contextTitle', 'text-center');\n            // ContextTitle.prepend(logo); //on ajoute le logo celene;\n\n            // Append.\n            contextMenu.append(contextTitle);\n            contextMenu.append(contextMenuItemFirst);\n            contextMenu.append(contextMenuItemSecond);\n            if (!typeof window.getSelection !== \"undefined\" && contextMenuItemThird) {\n                contextMenu.append(contextMenuItemThird);\n            }\n            contextMenu.append(contextMenuItemFourth);\n\n            contextMenu.append(contextMenuItemSixth);\n            document.body.append(contextMenu);\n\n            const posX = window.innerWidth - mouseX >= 250 ? mouseX : mouseX - 200;\n            const posY = window.innerHeight - mouseY >= 200 ? mouseY : mouseY - 200;\n\n            contextMenu.style.top = `${posY}px`;\n            contextMenu.style.left = `${posX}px`;\n        }\n\n\n        /**\n         *\n         * @returns selected text\n         */\n        function getSelectedText() {\n            // Check si du text est surligné, si oui le récupérer pour permettre;\n            // Une copie plus étendu que le event.target (copier la selection);\n            let text = \"\";\n            if (typeof window.getSelection != \"undefined\") {\n                text = window.getSelection().toString();\n            } else if (typeof document.selection != \"undefined\" && document.selection.type == \"Text\") {\n                text = document.selection.createRange().text;\n            }\n            return text;\n        }\n\n\n        // Vérifier que le menu existe. S'il existe on le supprime et on le recréé;\n        /**\n         *\n         * @param {*} e = event\n         */\n        function checkMenu(e) {\n            const words = e.target.innerText.split(\" \");\n            if (document.getElementById('context-menu')) {\n                document.getElementById('context-menu').remove();\n                createMenu(e, words);\n            } else {\n                createMenu(e, words);\n            }\n        }\n\n        /**\n         *\n         * @return bar\n         */\n        function createOptionsBar() {\n            const bar = document.createElement('div');\n            bar.classList.add('options-bar');\n            bar.id = \"options-bar\";\n\n            //bouton pour arrêter\n            const play = document.createElement('button');\n            // play.innerHTML = \"<span>ARRÊTER</span>\";\n            const spanArret = document.createElement('span');\n            spanArret.innerText = \"ARRÊTER\";\n            play.append(spanArret);\n            play.classList.add('play-btn');\n            play.onclick = (e) => {\n                e.preventDefault();\n                if (window.speechSynthesis.speaking) {\n                    window.speechSynthesis.cancel(); //on arrête\n                }\n            };\n\n            const pause = document.createElement('button');\n            const spanPause = document.createElement('span');\n            spanPause.innerText = \"PAUSE\";\n            pause.append(spanPause);\n            pause.classList.add('play-btn');\n            pause.onclick = (e) => {\n                e.preventDefault();\n                if (window.speechSynthesis.speaking && spanPause.innerText === \"PAUSE\") {\n                    window.speechSynthesis.pause();\n                    spanPause.innerText = \"REPRENDRE\";\n                } else if (window.speechSynthesis.paused && spanPause.innerText === \"REPRENDRE\") {\n                    window.speechSynthesis.resume();\n                    spanPause.innerText = \"PAUSE\";\n                }\n            };\n\n            bar.append(play);\n            bar.append(pause);\n            document.body.append(bar);\n        }\n\n        /**\n         * @return remove options bar\n         */\n        function removeOptionsBar() {\n            if (document.getElementById('options-bar')) {\n                document.getElementById('options-bar').remove();\n            }\n        }\n    });\n\n    const isClassForbiddenTts = (element) => {\n        // Liste des divs sur lesquelles on ne veut surtout pas changer la MEP avec le TTS.\n        let doNotInclude;\n        const divToNotInclude = [\n            \"generalbox\",\n            \"secondary-navigation\",\n            \"navbar\",\n            \"nav\",\n            \"drawers\",\n            \"completion-info\",\n            \"card\"\n        ];\n        for (let i = 0; i < divToNotInclude.length; i++) {\n            if (\n                element.target.classList.contains(divToNotInclude[i]) ||\n                (element.target.getAttribute('role') && element.target.getAttribute('role') === \"main\")\n            ) {\n                return false;\n            } else {\n                doNotInclude = true;\n            }\n        }\n        return doNotInclude;\n    };\n\n    // Virer le menu sur un click simple.\n    document.body.addEventListener('click', (e) => {\n        if (document.getElementById('context-menu')) {\n            if (!e.target.classList.contains(\"item\")) { //vérifier qu'on ne click pas sur une option du menu\n                document.getElementById('context-menu').remove();\n            }\n        }\n    });\n\n    // Generation of a toast message to indicate : The copy has been done. The content of what was copied.\n    class Toast {\n        constructor(textToDisplay, color, time) {\n            this.message = textToDisplay;\n            this.color = color;\n            this.time = time;\n            this.element = null;\n\n            const element = document.createElement('div');\n            element.className = \"toast-notification\";\n            this.element = element;\n            const countElements = document.getElementsByClassName(\"toast-notification\");\n\n            element.style.opacity = 0.8;\n\n            element.style.marginBottom = (countElements.length * 55) + \"px\";\n\n            element.style.backgroundColor = this.color;\n\n            const message = document.createElement(\"div\");\n            message.className = \"message-container\";\n            message.textContent = this.message;\n\n            element.appendChild(message);\n\n            const close = document.createElement(\"div\");\n            close.className = \"close-notification\";\n\n            const icon = document.createElement(\"i\");\n            icon.className = \"lni lni-close\";\n\n            close.appendChild(icon);\n\n            element.append(close);\n\n            document.body.appendChild(element);\n\n            setTimeout(function () {\n                element.remove();\n            }, this.time); // Do not change time here, check the construct function. It shall be a parameter.\n\n            close.addEventListener(\"click\", () => {// If user wants to close before timeout.\n                element.remove();\n            });\n        }\n    }\n};\n"],"names":["language","document","body","addEventListener","e","bodyEl","createMenu","event","synth","window","speechSynthesis","clientX","mouseX","clientY","mouseY","utterThis","SpeechSynthesisUtterance","target","innerText","targetInnerHtml","innerHTML","contextMenu","createElement","id","contextMenuItemFirst","classList","add","onclick","preventDefault","bar","play","spanArret","append","speaking","cancel","pause","spanPause","paused","resume","createOptionsBar","lang","rate","pitch","speak","name","wordStart","charIndex","wordLength","charLength","undefined","substring","match","length","wordEnd","word","markedText","remove","querySelectorAll","forEach","div","span","replaceWith","getElementById","contextMenuItemSecond","navigator","clipboard","writeText","then","Toast","contextMenuItemFifth","elementToChange","style","filter","contextMenuItemSixth","location","reload","contextMenuItemThird","getSelection","text","toString","selection","type","createRange","getSelectedText","contextMenuItemFourth","doc","range","selectNodeContents","removeAllRanges","addRange","contextTitle","posX","innerWidth","posY","innerHeight","top","left","contains","isClassForbiddenTts","split","checkMenu","element","doNotInclude","divToNotInclude","i","getAttribute","constructor","textToDisplay","color","time","message","className","countElements","getElementsByClassName","opacity","marginBottom","backgroundColor","this","textContent","appendChild","close","icon","setTimeout"],"mappings":"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"}